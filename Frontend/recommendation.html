{% extends "base.html" %}

{% block title %}Stocks Recommendations{% endblock %}

{% block navigationbar %}
<div class="topnav">
    <a href={{url_for('index')}}>Home</a>
    <a href={{url_for('analyst')}}>Analyst View</a>
    <a href={{url_for('stocks')}}>Hot Stocks</a>
    <a class = "active" href="{{url_for('recommendation')}}">Recommendations</a>
    <a href="#about">About</a>
  </div>
<div class="container">
{% endblock %}

{% block forms %}
<form action="/generate_rec" method="POST">
<label for="priority">Prioritise</label>
<select id ="priority" name ="priority">
    {% for option in dropdown_options_for_rec['priority'] %}
        <option value="{{ option }}" {% if form_values['priority'] == option %}selected{% endif %}>{{ option }}</option>
    {% endfor %}
</select>
<label for="period">Period</label>
<select id ="period" name ="period">
    {% for option in dropdown_options_for_rec['period'] %}
        <option value="{{ option }}" {% if form_values['period'] == option %}selected{% endif %}>{{ option }}</option>
    {% endfor %}
</select>
<label for="num">Number of Stocks</label>
<select id ="num" name ="num">
    {% for option in dropdown_options_for_rec['num'] %}
        <option value="{{ option }}" {% if form_values['num'] == option %}selected{% endif %}>{{ option }}</option>
    {% endfor %}
</select>
<label for="sort-by">Sort By</label>
<select id ="sort-by" name ="sort-by">
    {% for option in dropdown_options_for_rec['sort-by'] %}
        <option value="{{ option }}" {% if form_values['sort-by'] == option %}selected{% endif %}>{{ option }}</option>
    {% endfor %}
</select>
<input type="submit" value="Generate" id="submit-button">
</form>
{% endblock %}

{% block df %}
<div class="container">
    <h1>Recommendations</h1>
  <table class="table table-striped">
      <thead>
          <tr>
              <th>Company</th>
              <th>Average Upside</th>
              <th>Average Target</th>
              <th>Number of Recommendations</th>
              <th>LTP</th>
              <th>Max Target</th>
              <th>Min Target</th>
              <th>Max Upside</th>
              <th>Min Upside</th>
              <th>Details</th>
          </tr>
      </thead>
      <tbody>
          {% for index, row in df.iterrows() %}
          <tr>
              <th>{{ row.name }}</th>
              <td>{{ row['Average Upside'] }}</td>
              <td>{{ row['Average Target'] }}</td>
              <td>{{ row['Number of Recommendations'] }}</td>
              <td>{{ row['LTP'] }}</td>
              <td>{{ row['Max Target'] }}</td>
              <td>{{ row['Minimum Target'] }}</td>
              <td>{{ row['Max Upside'] }}</td>
              <td>{{ row['Minimum Upside'] }}</td>
              <td><button class="eye-button" data-toggle="modal" data-target="#detailsModal" data-company="{{ row.name }}">&#128065;</button></td>
          </tr>
          {% endfor %}
      </tbody>
  </table>
</div>
<div id="detailsModal" class="modal">
  <div class="modal-content">
      <span class="close">&times;</span>
      <div id="stock-details"></div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
      const eyeButtons = document.querySelectorAll('.eye-button');
      const modal = document.getElementById('detailsModal');
      const closeBtn = modal.querySelector('.close');

      eyeButtons.forEach(button => {
          button.addEventListener('click', function () {
              const company = this.getAttribute('data-company');
              fetch(`/get_stocks_details_for_rec?company=${company}`)
                  .then(response => response.json())
                  .then(data => {
                      const stockDetails = document.getElementById('stock-details');
                      stockDetails.innerHTML = data.html;
                      modal.style.display = 'block';
                  });
          });
      });

      closeBtn.addEventListener('click', function () {
          modal.style.display = 'none';
      });

      window.addEventListener('click', function (event) {
          if (event.target === modal) {
              modal.style.display = 'none';
          }
      });

  });
</script>
{% endblock %}
</div>

